<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hosinsa.mapper.MemberAddressMapper">
	<!-- getListOrder -->
	<select id="getListOrder" resultType="com.hosinsa.domain.MemberAddressVO">
		<![CDATA[
			SELECT * FROM HOSINSA_MEMBER_ADDRESS WHERE BASIC = 'O' AND ID = #{id} UNION
			SELECT ADDRESS_NO, ID, RECIPIENT, SHIPPING, PHONE, TEL, ZIPCODE, ADDRESS, BASIC
				FROM
				(SELECT * FROM HOSINSA_MEMBER_ADDRESS ORDER BY ADDRESS_NO DESC)
			WHERE ROWNUM <= 2 AND ID = #{id}
		]]>
	</select>
	<!-- readBasic -->
	<select id="readBasic" resultType="com.hosinsa.domain.MemberAddressVO">
		SELECT * FROM HOSINSA_MEMBER_ADDRESS WHERE BASIC = 'O' AND ID = #{id}
	</select>
	<!-- getListWithPaging -->
	<select id="getListWithPaging" resultType="com.hosinsa.domain.MemberAddressVO">
		<![CDATA[
			SELECT ADDRESS_NO, ID, RECIPIENT, SHIPPING, PHONE, TEL, ZIPCODE, ADDRESS, BASIC
			FROM
				(SELECT ROWNUM RN, ADDRESS_NO, ID, RECIPIENT, SHIPPING, PHONE, TEL, ZIPCODE, ADDRESS, BASIC
				FROM HOSINSA_MEMBER_ADDRESS WHERE ROWNUM <= #{b_pageNum} * #{b_amount})				
			WHERE RN > (#{b_pageNum} - 1) * #{b_amount}
		]]>
	</select>
	<!-- registerSelectKey -->
	<insert id="registerSelectKey">
		<selectKey keyProperty="address_no" order="BEFORE" resultType="Long">
			SELECT SEQ_MEMBER_ADDRESS.NEXTVAL FROM DUAL
		</selectKey>
			INSERT INTO INTO HOSINSA_MEMBER_ADDRESS(ADDRESS_NO, ID, RECIPIENT, SHIPPING, PHONE, TEL, ZIPCODE, ADDRESS, BASIC)
			VALUES(SEQ_MEMBER_ADDRESS.NEXTVAL, #{id}, #{recipient}, #{shipping}, #{phone}, #{tel}, #{zipcode}, #{address}, #{basic})
	</insert>
	<!-- read -->
	<select id="read" resultType="com.hosinsa.domain.MemberAddressVO">
		SELECT * FROM HOSINSA_MEMBER_ADDRESS WHERE ADDRESS_NO = #{address_no}
	</select>
	<!-- modifyBasic -->
	<update id="modifyBasic">
		UPDATE HOSINSA_MEMBER_ADDRESS SET
		BASIC = 'X'
		WHERE ADDRESS_NO = (SELECT ADDRESS_NO FROM HOSINSA_MEMBER_ADDRESS WHERE BASIC='O')
	</update>
	<!-- modify -->
	<update id="modify">
		UPDATE HOSINSA_MEMBER_ADDRESS SET
		RECIPIENT = #{recipient},
		SHIPPING = #{shipping},
		PHONE = #{phone},
		TEL = #{tel},
		ZIPCODE = #{zipcode},
		ADDRESS = #{address},
		BASIC = #{basic}
		WHERE ADDRESS_NO = #{address_no}
	</update>
	<!-- remove -->
	<delete id="remove">
		DELETE FROM HOSINSA_MEMBER_ADDRESS WHERE ADDRESS_NO = #{address_no}
	</delete>
	<!-- getTotalCountAddress -->
	<select id="getTotalCountAddress" resultType="int">
		SELECT COUNT(*) FROM HOSINSA_MEMBER_ADDRESS WHERE ID = #{id}
	</select>

</mapper>